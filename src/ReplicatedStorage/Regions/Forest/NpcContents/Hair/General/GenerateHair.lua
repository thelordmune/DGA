--!strict
local InsertService = game:GetService "InsertService"

local HAIR_DATA = {
	Male = {
		Regular = {
			13515609141, 13002675302, 15354053211, 12911961302, 12875433848, 13458529673, 7145036730, 13433250227,
			14594033045, 10472547652, 9678794874, 7436421066, 12283951209, 12281536963, 8082486982, 9930021350, 7222634196,
			7062107080, 6564177190, 13604405273, 13613963807, 18730352272, 93115305083995, 16258214383, 85258244947060, 16811634288,
			100286022000074, 18614035623, 18654028028, 113474806108831, 14761240955, 18644793758, 15431812636, 12007649057, 15228643039,
			4772335492, 18428787351, 17156849019, 99548742368793, 17660929664, 14763696930, 14720386664, 16088468918, 12269536686, 101960311555674,
			17828076063, 116655414869553, 17343539011, 102525512380384, 102368495931089, 102705176803424, 16752503082, 17325416471, 12454026428, 131046490226921,
			17856933034, 17537788434, 18509795747, 17342752605, 17538185956, 17559553558, 13985919654, 94461657872694, 17334331827, 123021097004692, 16040030579,
			8213808170, 14258472141, 4878040985, 11461141476, 14705261988, 15670240923, 78251890632438, 15837280405, 17166707678, 16848737789, 18716065433, 
			17354005379, 12215653863, 295453051, 17535252603, 121073024887277, 13336060119, 74968114329448, 14896136763, 18964955410, 18199466043, 15366803289,
			15860553784, 14959928960, 16216120519, 17176221540, 17429768281, 94160354504750, 9057322582, 15927551085, 17506035464, 121897392870355, 17391547393,
			120478611992895, 14917257190, 18558445206, 16732618611, 18539863421, 6216675304, 14892240503, 15505725140, 11377605079, 12512752850, 12523822861,
			4904074569, 185812332
		},
		Black = {
			84399869003478, 16324156451, 16384059895, 16612265839, 16549916876, 17184574257, 89465572614943, 18510413378,
			112976426790152, 16384914512, 72783086750964, 110870943219148, 5534852325, 13004659172, 11925526319, 11244910596,
			13143910884, 13983155539, 12455993745, 116421873837698, 16641413515, 16641413515, 12094575759, 17260820249, 18936679248,
			7390659411, 15449062633, 12579423689, 14511231632, 14666341458, 13628394874, 105070536586061, 96652441771066, 17341565507,
			15633204046, 18503024245, 18697914465, 17364092576, 17750337670, 5198069544, 6983893148, 15921775555, 6712905660, 4584980640,
			6995572325, 8696081004, 4584981984, 112929269022671, 6905438759, 5153045569, 5164439083, 87681721014719, 12105975615, 91665539658635,
			12866747115, 117451818934668, 7442838146, 17836503900, 11287051438, 16088398820, 18619205456, 12866753560, 15789786250, 70436997645504,
			5100703261, 108670561005054, 3993395372, 14125533276, 12179467440, 79801074422856
		}
	},
	Female = {
		Regular = {
			93927804346898, 18580292693, 123096178393623, 108846339477962, 16929998541, 113689970157202, 80713242389726,
			104184728776492, 14248258727, 137357612887179, 16653542035, 116216034308754, 18570730523, 130486747197569,
			16061696659, 106688889781612, 103480402812089, 110018811541640, 80029203880034, 17228828321, 17770226592,
			82123981462979, 17470443420, 17464271716, 17388769202, 102840277163839, 112289228817384, 5029336839,
			17332166677, 18100482783, 17537709999, 14276180507, 12397744697, 8666972398, 13446595752, 12843385114,
			13232401920, 8154699751, 15696996201, 129912855709496, 7602557150, 12865232071, 15085285216, 13337255262,
			17861245895, 11942405195, 13012552498, 11106121618, 123598407579700, 16640134523, 18135792182, 77403981047039,
			17165429539, 17563617890, 138759632375439, 119853562324203, 17654280271, 17231020955, 17211776772, 13472807890,
			9424759646, 10078496059, 13456038895, 11428234354, 12506032024, 12507759642, 11101076476, 7620726200, 6571562126,
			7960758771, 11387072569, 8031570897, 6441072389, 7439158772, 6210514083, 6754446477, 1708329071, 6475273980, 4997328475,
			4710923961, 4966169337, 5548484755
		},
		Black = {
			15069727041, 12616684153, 16379907094, 15893914533, 16379946117, 12542448389, 15184794900, 17632059178, 10424152958,
			17025026441, 15408979186, 15484158696, 12947220852, 14171199663, 14826853111, 13327495599, 13622008596, 16617499966,
			15029060883, 15176484789, 96056692153455, 18536946933
		}
	}
}

local function getRandomHairIds(gender: string, isBlack: boolean, count: number)
	local hairPool = HAIR_DATA[gender][isBlack and "Black" or "Regular"]
	local selected = {}
	local poolSize = #hairPool;

	count = math.min(count, poolSize)

	while #selected < count do
		local index = math.random(1, poolSize)
		local hairId = hairPool[index]

		if not table.find(selected, hairId) then
			table.insert(selected, hairId)
		end
	end

	return selected;
end

return function(npc: Model, mainConfig)
	if not npc then
		return
	end

	local humanoid = npc:FindFirstChild("Humanoid")
	if not humanoid then
		return
	end

	-- Determine gender and color randomly
	local isMale = math.random() > 0.5
	local isBlack = math.random() > 0.7 -- 30% chance for black hair
	local gender = isMale and "Male" or "Female"

	-- Get exactly 1 random hair ID (to prevent multiple hairs)
	local hairIds = getRandomHairIds(gender, isBlack, 1)

	for _, hairId in hairIds do
		-- Safe asset loading with pcall
		local success, result = pcall(function()
			return InsertService:LoadAsset(hairId)
		end)

		if success and result then
			-- Find the accessory in the loaded model
			local accessory = result:FindFirstChildWhichIsA("Accessory")
			if accessory then
				-- Clone the accessory (don't parent the whole model)
				local hairAccessory = accessory:Clone()
				-- Use AddAccessory for proper attachment
				humanoid:AddAccessory(hairAccessory)
			end
			-- Clean up the loaded model
			result:Destroy()
		else
			warn("[GenerateHair] Failed to load hair asset:", hairId, result)
		end
	end
end